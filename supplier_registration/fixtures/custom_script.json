[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Supplier", 
  "modified": "2019-02-03 18:58:09.022148", 
  "name": "Supplier-Client", 
  "script": "// fetch from supplier registration\ncur_frm.add_fetch(\"supplier_registration_application\", \"status\", \"supplier_registration_status\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"full_name_organization\", \"supplier_name\");\n\ncur_frm.add_fetch(\"supplier_registration_application\", \"supply\", \"supply\");\n\n\ncur_frm.add_fetch(\"supplier_registration_application\", \"construction\", \"construction\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"maintenance\", \"maintenance\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"engineering_consultancy\", \"engineering__consultancy\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"training\", \"training_ch\");\n\n\ncur_frm.add_fetch(\"supplier_registration_application\", \"business_registration_type\", \"business_registration_type\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"web_site\", \"web_site\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"telephone_number\", \"telephone_number\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"address\", \"address\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"organization_email_address\", \"organization_email_address\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"fax_number\", \"fax_number\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"contact_person_name\", \"contact_person_name\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"contact_person_title\", \"contact_person_title\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"contact_person_phone\", \"contact_person_phone\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"contact_person_email\", \"contact_person_email\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"legal_organizational_structure\", \"business_legal_organizational_structure\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"year_organization_establishment\", \"year_of_organization_establishment\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"business_license_number\", \"business_license_number\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"place_business_registration\", \"place_of_business_registration\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"description_products_services_offered\", \"description_of_products_services_offered\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"number_technical_staff\", \"number_of_technical_staff\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"quality_management_implemented\", \"is_quality_management_system_implemented\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"health_safety_environmental_implemented\", \"is_health_safety_and_environmental_system_implemented\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"upload_list_experience\", \"please_upload__of_previous_experience\");\n\n\ncur_frm.add_fetch(\"supplier_registration_application\", \"copy_company_memorandum\", \"copy_of_company_memorandum\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"copy_articles_association\", \"copy_of_company_articles_of_association\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"copy_valid_business_license\", \"_copy_of_valid_business_license\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"expiration_date_business_license\", \"date_of_valid_business_license\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"copy_valid_commercial_registry\", \"copy_of_valid_commercial_registry\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"expiration_date_commercial_registry\", \"date_of_valid_commercial_registry\");\n\ncur_frm.add_fetch(\"supplier_registration_application\", \"tax_n_bpmc\", \"tax_id\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"commercial_registry_number\", \"commercial_registry_number\");\n\ncur_frm.add_fetch(\"supplier_registration_application\", \"preferred_correspondence_language\", \"language\");\n\ncur_frm.add_fetch(\"supplier_registration_application\", \"user_email\", \"user_email\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"name1\", \"name1\");\n\ncur_frm.add_fetch(\"supplier_registration_application\", \"registration_pledge\", \"registration_pledge\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"supplier_bank_name\", \"supplier_bank_name\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"supplier_bank_address\", \"supplier_bank_address\");\ncur_frm.add_fetch(\"supplier_registration_application\", \"supplier_bank_account_number\", \"supplier_bank_account_number\");\n\n\n// fetch from Supplier Financial Classification Guide\ncur_frm.add_fetch(\"supplier_financial_classification_guide\", \"company_capital_greater_than_a\", \"company_capital_greater_than_a\");\ncur_frm.add_fetch(\"supplier_financial_classification_guide\", \"company_capital_greater_than_b\", \"company_capital_greater_than_b\");\ncur_frm.add_fetch(\"supplier_financial_classification_guide\", \"company_capital_less_than_or_equal_b\", \"company_capital_less_than_or_equal_b\");\ncur_frm.add_fetch(\"supplier_financial_classification_guide\", \"company_capital_greater_than_c\", \"company_capital_greater_than_c\");\ncur_frm.add_fetch(\"supplier_financial_classification_guide\", \"company_capital_less_than_or_equal_c\", \"company_capital_less_than_or_equal_c\");\ncur_frm.add_fetch(\"supplier_financial_classification_guide\", \"company_capital_less_than_or_equal_d\", \"company_capital_less_than_or_equal\");\n\n\n\n\n// Data Validation\nfrappe.ui.form.on(\"Supplier\", \"validate\", function(frm) {\n    if (frm.doc.supplier_registration_status!==\"Approved\") {\n        frappe.msgprint(__(\"You can not create Supplier when 'Supplier Registration Application' not approved\"));\n        frappe.validated = false;\n    }\n});\n\n// Date Validation 1\nfrappe.ui.form.on(\"Supplier\", \"refresh\", function(frm) {\n    if (frm.doc.date_of_valid_business_license < frappe.datetime.get_today() && frm.doc.disabled==0) {\n        frappe.msgprint(__(\"Business License is expired\"));\n    }\n});\n// Date Validation 2\nfrappe.ui.form.on(\"Supplier\", \"refresh\", function(frm) {\n    if (frm.doc.date_of_valid_commercial_registry < frappe.datetime.get_today() && frm.doc.disabled==0) {\n        frappe.msgprint(__(\"Commercial Registry is expired\"));\n    }\n});\n// Disabled supplier msg\nfrappe.ui.form.on(\"Supplier\", \"refresh\", function(frm) {\n    if (frm.doc.disabled==1) {\n        frappe.msgprint(__(\"This Supplier is disabled\"));\n    }\n});\n// Open new doc from current doc with fetch data to new\n\nfrappe.ui.form.on(\"Supplier\", \"add_to_contact\", function(frm) {\n  frappe.new_doc(\"Contact\", {\"email_id\": frm.doc.user_email,\n                        \"first_name\": frm.doc.name1\n}\n); \n});\n// Dashboard hide \n\nfrappe.ui.form.on('Supplier', {\n\trefresh: function(frm) {\n\t\tfrm.dashboard.show();\n\t\tif(frm.doc.disabled == 1) {\n\t\t\tfrm.dashboard.hide();\n\t\t}\n\t}\n})\n\n// Set supplier financial classification\nfrappe.ui.form.on(\"Supplier\", {\n\tvalidate: function(frm) {\n\t\tif (frm.doc.company_capital_amount > frm.doc.company_capital_greater_than_a) \n                                 {\n\t\t\tfrm.set_value(\"financial_classification\", \"A\");\n                        \n\t\t    }\n                  else if (frm.doc.company_capital_amount > frm.doc.company_capital_greater_than_b && frm.doc.company_capital_amount <= frm.doc.company_capital_less_than_or_equal_b )\n                    {\n\t\t\tfrm.set_value(\"financial_classification\", \"B\");\n\t\t}\n                 else if (frm.doc.company_capital_amount > frm.doc.company_capital_greater_than_c && frm.doc.company_capital_amount <= frm.doc.company_capital_less_than_or_equal_c)\n                    {\n\t\t\tfrm.set_value(\"financial_classification\", \"C\");\n\t\t}\n                else if (frm.doc.company_capital_amount <= frm.doc.company_capital_less_than_or_equal)\n                    {\n\t\t\tfrm.set_value(\"financial_classification\", \"D\");\n\t\t}\n\t}\n       \n});\n\n// fetch link when before save\nfrappe.ui.form.on(\"Supplier\", \"before_save\", function(frm) {\n  frappe.model.with_doc(\"Supplier Financial Classification Guide\", frm.doc.supplier_financial_classification_guide, function() { \n     var po = frappe.model.get_doc(\"Supplier Financial Classification Guide\", frm.doc.supplier_financial_classification_guide);\n     frm.set_value(\"company_capital_greater_than_a\", po.company_capital_greater_than_a);\n     frm.set_value(\"company_capital_greater_than_b\", po.company_capital_greater_than_b);\n     frm.set_value(\"company_capital_less_than_or_equal_b\", po.company_capital_less_than_or_equal_b);\n     frm.set_value(\"company_capital_greater_than_c\", po.company_capital_greater_than_c);\n     frm.set_value(\"company_capital_less_than_or_equal_c\", po.company_capital_less_than_or_equal_c);\n     frm.set_value(\"company_capital_less_than_or_equal\", po.company_capital_less_than_or_equal_d);\n\n    });\n\n});\n// Data Validation \nfrappe.ui.form.on(\"Supplier\", \"validate\", function(frm) {\n    if (frm.doc.contractor==0 && frm.doc.authorized_representative==0 && frm.doc.manufacturer==0 && frm.doc.trader==0) {\n        frappe.msgprint(__(\"You shall select at least one choice from Nature of Business section\"));\n        frappe.validated = false;\n    }\n});", 
  "script_type": "Client"
 }
]