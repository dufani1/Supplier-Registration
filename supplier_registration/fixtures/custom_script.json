[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Supplier", 
  "modified": "2019-07-18 20:15:38.165015", 
  "name": "Supplier-Client", 
  "parent": null, 
  "parentfield": null, 
  "parenttype": null, 
  "script": "// Data Validation\nfrappe.ui.form.on(\"Supplier\", \"validate\", function(frm) {\n    if (frm.doc.supplier_registration_status!==\"Approved\") {\n        frappe.msgprint(__(\"You can not create Supplier when 'Supplier Registration Application' not approved\"));\n        frappe.validated = false;\n    }\n});\n\n// Date Validation 1\nfrappe.ui.form.on(\"Supplier\", \"refresh\", function(frm) {\n    if (frm.doc.date_of_valid_business_license < frappe.datetime.get_today() && frm.doc.disabled==0) {\n        frappe.msgprint(__(\"Business License is expired\"));\n        frm.set_value(\"licences_status\",\"Expired\");\n    }\n});\n// Date Validation 2\nfrappe.ui.form.on(\"Supplier\", \"refresh\", function(frm) {\n    if (frm.doc.date_of_valid_commercial_registry < frappe.datetime.get_today() && frm.doc.disabled==0) {\n        frappe.msgprint(__(\"Commercial Registry is expired\"));\n         frm.set_value(\"licences_status\",\"Expired\");\n    }\n});\n// Date Validation 3\nfrappe.ui.form.on(\"Supplier\", \"refresh\", function(frm) {\n    if (frm.doc.date_of_valid_commercial_registry > frappe.datetime.get_today() && frm.doc.disabled==0 && frm.doc.date_of_valid_business_license > frappe.datetime.get_today()) {\n        frm.set_value(\"licences_status\",\"Valid\");\n    }\n});\n\n// Disabled supplier msg\nfrappe.ui.form.on(\"Supplier\", \"refresh\", function(frm) {\n    if (frm.doc.disabled==1) {\n        frappe.msgprint(__(\"This Supplier is disabled\"));\n    }\n});\n\n\n// Data Validation 4\nfrappe.ui.form.on(\"Supplier\", \"validate\", function(frm) {\n    if (frm.doc.contractor==0 && frm.doc.authorized_representative==0 && frm.doc.manufacturer==0 && frm.doc.trader==0) {\n        frappe.msgprint(__(\"You shall select at least one choice from Nature of Business section\"));\n        frappe.validated = false;\n    }\n});\n\n// Make field mandatory based on value of another field\ncur_frm.cscript.custom_validate= function(doc){\ncur_frm.set_df_property(\"brand_or_company_table\", \"reqd\", doc.authorized_representative==1 && doc.registration_status==\"Completed\");\n}\n// Filter child table field based on parent field 1\nfrappe.ui.form.on(\"Supplier\", \"onload\", function (frm) {\n    cur_frm.set_query(\"brand_or_company\", \"brand_or_company_table\", function (frm) {\n        return {\n            \n            \"filters\": {\n                \"supplier\": cur_frm.doc.name\n            }\n        }\n    });\n});\n// filtration of the field in doctype based on some criteria\nfrappe.ui.form.on(\"Supplier\", \"onload\", function(frm) {\n    cur_frm.set_query(\"supplier_group\", function() {\n        return {\n            \"filters\": {\n                \"is_group\": \"0\"\n            }\n        };\n    });\n});\n\n// update and save in other documents when validate\nfrappe.ui.form.on(\"Supplier\", {\n    validate : function(frm) {\n        if (frm.doc.registration_status==\"Completed\"){\n        frappe.call({\n            \"method\": \"frappe.client.set_value\",\n            \"args\": {\n                \"doctype\": \"Supplier Registration Application\",\n                \"name\": frm.doc.supplier_registration_application,\n                \"fieldname\": \"bmpc_supplier_registration_no\",\n                \"value\": frm.doc.name\n                   }\n        });\n     }\n    }\n});", 
  "script_type": "Client"
 }
]